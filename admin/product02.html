<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>상품관리 / 카테고리 관리</title>
  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- CSS -->
  <link rel="stylesheet" href="https://unpkg.com/aos@2.3.1/dist/aos.css" /> <!--AOS 애니메이션-->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.css" /> <!--스와이퍼-->
  <link rel="stylesheet" href="../css/font-awesome.min.css"> <!--fontawsome-->
  <link rel="stylesheet" href="../css/common.css" />
  <link rel="stylesheet" href="../css/custom.css" />
  <link rel="stylesheet" href="../admin/css/admin.css" />
  <!-- JS -->
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
  <script src="../js/common.js"></script>
</head>

<body>
<div id="product01" class="admin_common">
  <!----======== 관리자 레이아웃 상단    ========---->
  <section id="admin_header_wrap">
    <div id="admin_top_area">
      <div class="user_area">
        <p class="welcome"><b>관리자</b>님 안녕하세요.</p>
        <button onclick="location.href='login.html'">로그아웃</button>
      </div>
    </div>
    <div id="admin_side_area">
      <div class="logo_area">
        <a href="/admin/dashboard.html">
        <img class="logo" src="./img/logo_w.png" alt="logo.png">
        <p>ADMIN</p>
        </a>
      </div>
      <div class="side_btm_area">
        <!--메뉴-->
        <ul id="adm_nav">
          <!--DEPTH 1-->
          <li class="adm_nav_depth1"><a href="dashboard.html">대시보드</a></li>
          <li class="adm_nav_depth2_group">
            <p class="adm_nav_depth1">회원관리 <i class="fa fa-sort-desc" aria-hidden="true"></i></p>
            <!--DEPTH 2-->
            <ul class="adm_nav_depth2_ul">
              <li><a href="member01.html">일반회원</a></li>
              <li><a href="member02.html">정회원</a></li>
              <li><a href="member03.html">탈퇴회원</a></li>
              <li><a href="member04.html">정회원 승인</a></li>
            </ul>
          </li>
          <li class="adm_nav_depth2_group">
            <p class="adm_nav_depth1">서비스관리 <i class="fa fa-sort-desc" aria-hidden="true"></i></p>
            <!--DEPTH 2-->
            <ul class="adm_nav_depth2_ul">
              <li><a href="service01.html">상담예약</a></li>
              <li><a href="service02.html">프로그램</a></li>
              <li><a href="service03.html">컨시어지</a></li>
              <li><a href="service04.html">미션</a></li>
              <li><a href="service05.html">변화 그래프</a></li>
            </ul>
          </li>
          <li class="adm_nav_depth2_group">
            <p class="adm_nav_depth1">상품관리 <i class="fa fa-sort-desc" aria-hidden="true"></i></p>
            <!--DEPTH 2-->
            <ul class="adm_nav_depth2_ul">
              <li><a href="product01.html">상품관리</a></li>
              <li><a href="product02.html">카테고리 관리</a></li>
            </ul>
          </li>
          <li class="adm_nav_depth2_group">
            <p class="adm_nav_depth1">주문관리 <i class="fa fa-sort-desc" aria-hidden="true"></i></p>
            <!--DEPTH 2-->
            <ul class="adm_nav_depth2_ul">
              <li><a href="order01.html">주문관리</a></li>
              <li><a href="order02.html">구매확정</a></li>
              <li><a href="order03.html">취소관리</a></li>
              <li><a href="order04.html">교환관리</a></li>
              <li><a href="order05.html">반품관리</a></li>
            </ul>
          </li>
          <li class="adm_nav_depth2_group">
            <p class="adm_nav_depth1">컨텐츠관리 <i class="fa fa-sort-desc" aria-hidden="true"></i></p>
            <!--DEPTH 2-->
            <ul class="adm_nav_depth2_ul">
              <li><a href="contents01.html">미베르소개</a></li>
              <li><a href="contents02.html">프로그램</a></li>
              <li><a href="contents03.html">지점안내</a></li>
            </ul>
          </li>
          <li class="adm_nav_depth2_group">
            <p class="adm_nav_depth1">결제관리 <i class="fa fa-sort-desc" aria-hidden="true"></i></p>
            <!--DEPTH 2-->
            <ul class="adm_nav_depth2_ul">
              <li><a href="payment01.html">포스관리</a></li>
              <li><a href="payment02.html">적립금내역</a></li>
              <li><a href="payment03.html">마일리지내역</a></li>
            </ul>
          </li>
          <li class="adm_nav_depth2_group">
            <p class="adm_nav_depth1">게시판관리 <i class="fa fa-sort-desc" aria-hidden="true"></i></p>
            <!--DEPTH 2-->
            <ul class="adm_nav_depth2_ul">
              <li><a href="board01.html">공지사항</a></li>
              <li><a href="board02.html">자주하는질문</a></li>
            </ul>
          </li>
          <li class="adm_nav_depth1"><a href="review.html">리뷰관리</a></li>
          <li class="adm_nav_depth2_group">
            <p class="adm_nav_depth1">문의관리<i class="fa fa-sort-desc" aria-hidden="true"></i></p>
            <!--DEPTH 2-->
            <ul class="adm_nav_depth2_ul">
              <li><a href="inquiry01.html">상품문의</a></li>
              <li><a href="inquiry02.html">1:1문의</a></li>
            </ul>
          </li>
          <li class="adm_nav_depth2_group">
            <p class="adm_nav_depth1">설정<i class="fa fa-sort-desc" aria-hidden="true"></i></p>
            <!--DEPTH 2-->
            <ul class="adm_nav_depth2_ul">
              <li><a href="preferences01.html">배너관리</a></li>
              <li><a href="preferences02.html">팝업관리</a></li>
              <li><a href="preferences03.html">계정관리</a></li>
              <li><a href="preferences04.html">기본설정</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
    <script>
    $('.adm_nav_depth1').click(function() {
      $(this).siblings('.adm_nav_depth2_ul').slideToggle();
      $(this).parent().siblings().find('.adm_nav_depth2_ul').slideUp();
    });
    </script>
  </section>
  <!----======== 관리자 레이아웃 상단 끝 ========---->
  <section id="admin_contents_wrap">
  <!----======== 내용부분    ========---->
  <p class="title">상품관리 / 카테고리 관리 </p>
  <div class="btn_area">
    <button onclick="addCategory('depth1')">+ 대분류추가</button>
    <button onclick="saveAll()">전체완료</button>
  </div>
  <table class="table_defalt table2">
      <thead>
          <tr>
              <th colspan="3" width="120px">depth</th>
              <th width="500px">카테고리명</th>
              <th width="80px">노출여부</th>
              <th width="80px">등록일</th>
              <th width="220px">관리</th>
          </tr>
      </thead>
      <tbody id="categoryTable">
      </tbody>
  </table>
  <script>
  $(document).ready(function() {
            let categoryTable = $('#categoryTable');
            let date = new Date().toISOString().split('T')[0];

            window.addCategory = function(type, el) {
                let newRow;
                let parentRow = $(el).closest('tr');
                let lastSibling;
                if (type === 'depth1') {
                    newRow = `
                        <tr class="depth1">
                            <td colspan="3">대분류</td>
                            <td><input placeholder="카테고리명 입력"></td>
                            <td>
                                <select>
                                    <option>노출</option>
                                    <option>숨김</option>
                                </select>
                            </td>
                            <td>${date}</td>
                            <td class="in_btn_area">
                                <button class="in_btn" onclick="addCategory('depth2', this)">하위 분류 추가</button>
                                <button class="in_btn" onclick="deleteRow(this)">삭제</button>
                                <button class="in_btn save" onclick="saveRow(this)">완료</button>
                            </td>
                        </tr>`;
                    categoryTable.append(newRow);
                } else if (type === 'depth2') {
                    lastSibling = parentRow;
                    while (lastSibling.next().hasClass('depth2') || lastSibling.next().hasClass('depth3')) {
                        lastSibling = lastSibling.next();
                    }
                    newRow = `
                        <tr class="depth2">
                            <td class="space"></td>
                            <td colspan="2">중분류</td>
                            <td><input placeholder="카테고리명 입력"></td>
                            <td>
                                <select>
                                    <option>노출</option>
                                    <option>숨김</option>
                                </select>
                            </td>
                            <td>${date}</td>
                            <td class="in_btn_area">
                                <button class="in_btn" onclick="addCategory('depth3', this)">하위 분류 추가</button>
                                <button class="in_btn" onclick="deleteRow(this)">삭제</button>
                                <button class="in_btn save" onclick="saveRow(this)">완료</button>
                            </td>
                        </tr>`;
                    lastSibling.after(newRow);
                } else if (type === 'depth3') {
                    lastSibling = parentRow;
                    while (lastSibling.next().hasClass('depth3')) {
                        lastSibling = lastSibling.next();
                    }
                    newRow = `
                        <tr class="depth3">
                            <td colspan="2"></td>
                            <td>소분류</td>
                            <td><input placeholder="카테고리명 입력"></td>
                            <td>
                                <select>
                                    <option>노출</option>
                                    <option>숨김</option>
                                </select>
                            </td>
                            <td>${date}</td>
                            <td class="in_btn_area">
                                <button class="in_btn" onclick="deleteRow(this)">삭제</button>
                                <button class="in_btn save" onclick="saveRow(this)">완료</button>
                            </td>
                        </tr>`;
                    lastSibling.after(newRow);
                }
            }

            window.deleteRow = function(el) {
                let row = $(el).closest('tr');
                let rowDepth = row.attr('class');
                let nextRow = row.next();

                let canDelete = true;

                nextRow.each(function() {
                    let nextRowDepth = $(this).attr('class');
                    if (rowDepth === 'depth1' && nextRowDepth === 'depth2') {
                        canDelete = false;
                        return false;
                    }
                    if (rowDepth === 'depth2' && nextRowDepth === 'depth3') {
                        canDelete = false;
                        return false;
                    }
                    if (rowDepth === 'depth2' && nextRowDepth === 'depth1') {
                        return false;
                    }
                    if (rowDepth === 'depth3' && (nextRowDepth === 'depth1' || nextRowDepth === 'depth2')) {
                        return false;
                    }
                });

                if (canDelete) {
                    row.remove();
                } else {
                    alert('하위 분류가 있는 카테고리는 삭제할 수 없습니다.');
                }
            }

            window.editRow = function(el) {
                let row = $(el).closest('tr');
                row.find('input').prop('readonly', false);
                row.find('select').prop('disabled', false);
                $(el).text('완료').attr('onclick', 'saveRow(this)');
            }

            window.saveRow = function(el) {
                let row = $(el).closest('tr');
                row.find('input').prop('readonly', true);
                row.find('select').prop('disabled', true);
                $(el).text('수정').attr('onclick', 'editRow(this)');
                alert('변경사항이 저장되었습니다.');
            }

            window.saveAll = function(){
                categoryTable.find('input').prop('readonly', true);
                categoryTable.find('select').prop('disabled', true);
                categoryTable.find('button.save').text('수정').attr('onclick', 'editRow(this)');
                alert('변경사항이 저장되었습니다.');
            }
        });
  </script>
    
    <!----======== 내용부분 끝 ========---->
  </section>
  <!----======== 관리자 레이아웃 하단    ========---->
  <section id="admin_footer_wrap">
    <div></div>
  </section>
  <!----======== 관리자 레이아웃 하단 끝 ========---->
</div>
</body>
</html>